<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>DataHub元数据管理体验</title>
    <url>/posts/20231108113649-81a5898f.html</url>
    <content><![CDATA[<h3 id="Datahub"><a href="#Datahub" class="headerlink" title="Datahub"></a>Datahub</h3><p><img src="https://hoey-images.oss-cn-hangzhou.aliyuncs.com/img/image-20231108174154093.png" alt="image-20231108174154093"></p>
<p><strong>开源地址</strong>：<a href="https://github.com/datahub-project/datahub">https://github.com/datahub-project/datahub</a> </p>
<p>DataHub是由Linkedin开源的，官方Slogan：The Metadata Platform for the Modern Data Stack - 为现代数据栈而生的元数据平台。目的就是为了解决多种多样数据生态系统的元数据管理问题，它提供元数据检索、数据发现、数据监测和数据监管能力，帮助大家解决数据管理的复杂性。</p>
<p>DataHub基于Apache License 2开源，采用基于推送的数据收集架构（当然也支持pull拉取的方式），能够持续收集变化的元数据。当前版本已经集成了大部分流行数据生态系统接入能力，包括但不限于：Kafka, Airflow, MySQL, SQL Server, Postgres, LDAP, Snowflake, Hive, BigQuery。</p>
<p><strong>Datahub的优点：</strong></p>
<ul>
<li>名门开源，与Kafka同家庭。社区活跃，发展势头迅猛，版本更新迭代迅速。</li>
<li>定位清晰且宏远，Slogan可以看出团队的雄心壮志及后期投入，且不断迭代更新的版本也应证了这一点。</li>
<li>底层架构灵活先进，未扩展集成而生，支持推送和拉去模式，详见：<a href="https://datahubproject.io/docs/architecture/architecture/">https://datahubproject.io/docs/architecture/architecture/</a></li>
<li>UI界面简单易用，技术人员及业务人员友好</li>
<li>接口丰富，功能全面</li>
</ul>
<p><strong>Datahub的不足：</strong></p>
<ul>
<li>前端界面不支持国际化，界面的构建和使用逻辑不够中国化</li>
<li>版更更新迭代快，使用后升级是个难题</li>
<li>较多功能在建设中，例如Hive列级血缘</li>
<li>部分功能性能还需要优化，例如SQL Profile</li>
<li>中文资料不多，中文交流社群也不多</li>
</ul>
<p><strong>相关介绍</strong>：</p>
<p><a href="https://mp.weixin.qq.com/s/74gK3hTt7-j1lTbKFagbTQ">https://mp.weixin.qq.com/s/74gK3hTt7-j1lTbKFagbTQ</a><br><a href="https://mp.weixin.qq.com/s/iP6sc2DzPaeAKpSWNmf8hQ">https://mp.weixin.qq.com/s/iP6sc2DzPaeAKpSWNmf8hQ</a></p>
<p><strong>选型建议</strong>：</p>
<p>1）如果有至少半个前端开发人员+后台开发人员；<br>2）如果需要用户体验较好的数据资产管理平台；<br>3）如果有需要扩展支持各种平台、系统的元数据。请把Datahub列为最高选择。<br>尽管列举了一些不足，但是开源产品中Datahub目前是相对最好的选择。笔者也在生产中使用，有问题的可以随时沟通交流。</p>
<p><strong>商用版本</strong>: Metaphor（<a href="https://metaphor.io/%EF%BC%89%E6%98%AFDatahub%E7%9A%84SaaS%E7%89%88%E6%9C%AC%E3%80%82">https://metaphor.io/）是Datahub的SaaS版本。</a></p>
<h3 id="部署及安装"><a href="#部署及安装" class="headerlink" title="部署及安装"></a>部署及安装</h3><ol>
<li>执行命令</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python3 -m pip install --upgrade pip wheel setuptools</span><br><span class="line">python3 -m pip install --upgrade acryl-datahub</span><br><span class="line">datahub version</span><br></pre></td></tr></table></figure>

<blockquote>
<p>⚠️注: 在我们执行安装前，可以创建python虚拟环境</p>
</blockquote>
<ol start="2">
<li>从docker上拉取镜像部署，datahub提供了自动拉取镜像、自动部署节点的脚本，让部署一键操作</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">datahub docker quickstart</span><br></pre></td></tr></table></figure>

<blockquote>
<p>⚠️注: 如果你的网络不佳，或者是国内网络，过程会特别的漫长，我就是等了一天才好</p>
</blockquote>
<p>成功后terminal中展示：</p>
<p><img src="https://hoey-images.oss-cn-hangzhou.aliyuncs.com/img/image-20231108174029522.png" alt="image-20231108174029522"></p>
<p>下面我们登陆:</p>
<p><a href="http://localhost:9002/login?redirect_uri=/">http://localhost:9002/login?redirect_uri=%2F</a></p>
<p>user/pass: datahub/datahub</p>
<p><img src="https://hoey-images.oss-cn-hangzhou.aliyuncs.com/img/image-20231108174130857.png" alt="image-20231108174130857"></p>
<p>部署细节不懂的，可以参考: <a href="https://datahubproject.io/docs/quickstart">https://datahubproject.io/docs/quickstart</a></p>
<p>下一章我们结合Datahub API + 血缘解析工具，简单说一下怎么构建企业知识图谱</p>
]]></content>
  </entry>
  <entry>
    <title>DolphinScheduler 3.1.0 本地环境搭建</title>
    <url>/posts/20221228222917-aa59cf36.html</url>
    <content><![CDATA[<p>环境准备</p>
<ul>
<li>MacBook Pro (13-inch, 2020, Four Thunderbolt 3 ports)</li>
<li><a href="https://git-scm.com/downloads">Git</a></li>
<li><a href="https://www.oracle.com/technetwork/java/javase/downloads/index.html">JDK</a>: v1.8.x (Currently does not support jdk 11)</li>
<li><a href="http://maven.apache.org/download.cgi">Maven</a>: v3.5+</li>
<li><a href="https://nodejs.org/en/download">Node</a>: v16.13+ (dolphinScheduler version is lower than 3.0, please install node v12.20+)</li>
<li><a href="https://pnpm.io/installation">Pnpm</a>: v6.x</li>
<li>Zookeeper: 3.8</li>
</ul>
<p>1.克隆项目到本地</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/apache/dolphinscheduler.git</span><br></pre></td></tr></table></figure>

<p>2.导入项目到IDEA，并切换分支到<code>3.1.0</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git checkout 3.1.0-release</span><br></pre></td></tr></table></figure>

<p>3.编译项目</p>
<p>spotless是一种代码格式化工具，使用 spotless:apply 表示格式化module代码</p>
<p>mvnw同mvn的功能是一样的，mvnw做了项目适配</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./mvnw spotless:apply </span><br><span class="line">./mvnw clean install -Prelease -Dmaven.test.skip=true -Dcheckstyle.skip=true -Dmaven.javadoc.skip=true</span><br></pre></td></tr></table></figure>

<p>4.在mysql创建database数据库</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> SCHEMA dolphinschedulertest;</span><br></pre></td></tr></table></figure>

<p>找到脚本dolphinscheduler-dao/src/main/resources/sql/dolphinscheduler_mysql.sql并运行</p>
<p>5.修改项目配置文件</p>
<p>全局搜索<code>application.yaml</code>，将文件中涉及postgresql的替换为mysql</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   driver-class-name: org.postgresql.Driver</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   url: jdbc:postgresql://127.0.0.1:5432/dolphinscheduler</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   username: root</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   password: root</span></span><br><span class="line">driver-class-name: com.mysql.cj.jdbc.Driver</span><br><span class="line">url: jdbc:mysql://127.0.0.1:3306/dolphinschedulertest</span><br><span class="line">username: root</span><br><span class="line">password: 123456</span><br><span class="line"></span><br><span class="line">org.quartz.jobStore.driverDelegateClass: org.quartz.impl.jdbcjobstore.StdJDBCDelegate</span><br></pre></td></tr></table></figure>

<p>6.修改dolphinscheduler-bom下pom.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mysql-connector.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>7.修改logback-spring.xml</p>
<p>全局搜索logback-spring.xml，将下面内容添加到其中</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--将这句话加入到root节点下--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;STDOUT&quot;</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>8.配置启动项</p>
<p>分别配置MasterServer, WorkerServer, ApiApplicationServer</p>
<ul>
<li>MasterServer：Execute function <code>main</code> in the class <code>org.apache.dolphinscheduler.server.master.MasterServer</code> by Intellij IDEA, with the configuration <em>VM Options</em> <code>-Dlogging.config=classpath:logback-spring.xml -Ddruid.mysql.usePingMethod=false -Dspring.profiles.active=mysql</code></li>
<li>WorkerServer：Execute function <code>main</code> in the class <code>org.apache.dolphinscheduler.server.worker.WorkerServer</code> by Intellij IDEA, with the configuration <em>VM Options</em> <code>-Dlogging.config=classpath:logback-spring.xml -Ddruid.mysql.usePingMethod=false -Dspring.profiles.active=mysql</code></li>
<li>ApiApplicationServer：Execute function <code>main</code> in the class <code>org.apache.dolphinscheduler.api.ApiApplicationServer</code> by Intellij IDEA, with the configuration <em>VM Options</em> <code>-Dlogging.config=classpath:logback-spring.xml -Dspring.profiles.active=api,mysql</code>. After it started, you could find Open API documentation in <a href="http://localhost:12345/dolphinscheduler/swagger-ui/index.html">http://localhost:12345/dolphinscheduler/swagger-ui/index.html</a></li>
</ul>
<p>9.配置zookeeper</p>
<p>参考以前的博客<a href="https://blog.hoey.tk/2018/04/15/2018-04-15-hadoop-zookeeper%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA%E5%8F%8A%E5%85%B6%E4%BD%BF%E7%94%A8/">zookeeper部署</a></p>
<p>10.启动前端</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pnpm install</span><br><span class="line">pnpm run dev</span><br></pre></td></tr></table></figure>

<p>11.启动后端</p>
<p>分别在IDEA中运行MasterServer, WorkerServer, ApiApplicationServer</p>
<p>登陆账号密码 <font color="red">admin/dolphinscheduler123</font></p>
<p>参考文档：<a href="https://www.bookstack.cn/read/dolphinscheduler-3.1.0-en/af18cd17a04eb31f.md">https://www.bookstack.cn/read/dolphinscheduler-3.1.0-en/af18cd17a04eb31f.md</a></p>
<p>编译错误1：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[ERROR] Failed to execute goal com.github.eirslett:frontend-maven-plugin:1.12.1:pnpm (pnpm install) on project dolphinscheduler-ui: Failed to run task: &#x27;pnpm install&#x27; failed. org.apache.commons.exec.ExecuteException: Process exited with an error: 9 (Exit value: 9) -&gt; [Help 1]</span><br></pre></td></tr></table></figure>

<p>解决办法：</p>
<p>修改dolphinscheduler-ui模块下的pom.xml，修改后记得重新执行<code>./mvnw spotless:apply</code>格式化代码</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--                &lt;plugins&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                    &lt;plugin&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                        &lt;groupId&gt;com.github.eirslett&lt;/groupId&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                        &lt;artifactId&gt;frontend-maven-plugin&lt;/artifactId&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                        &lt;version&gt;$&#123;frontend-maven-plugin.version&#125;&lt;/version&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                        &lt;configuration&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                            &lt;pnpmInheritsProxyConfigFromMaven&gt;false&lt;/pnpmInheritsProxyConfigFromMaven&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                        &lt;/configuration&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                        &lt;executions&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                            &lt;execution&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                                &lt;id&gt;install node and pnpm&lt;/id&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                                &lt;goals&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                                    &lt;goal&gt;install-node-and-pnpm&lt;/goal&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                                &lt;/goals&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                                &lt;configuration&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                                    &lt;nodeVersion&gt;$&#123;node.version&#125;&lt;/nodeVersion&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                                    &lt;pnpmVersion&gt;$&#123;pnpm.version&#125;&lt;/pnpmVersion&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                                &lt;/configuration&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                            &lt;/execution&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                            &lt;execution&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                                &lt;id&gt;pnpm install&lt;/id&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                                &lt;goals&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                                    &lt;goal&gt;pnpm&lt;/goal&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                                &lt;/goals&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                                &lt;phase&gt;generate-resources&lt;/phase&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                                &lt;configuration&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                                    &lt;arguments&gt;install&lt;/arguments&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                                &lt;/configuration&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                            &lt;/execution&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                            &lt;execution&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                                &lt;id&gt;pnpm run build:prod&lt;/id&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                                &lt;goals&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                                    &lt;goal&gt;pnpm&lt;/goal&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                                &lt;/goals&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                                &lt;configuration&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                                    &lt;arguments&gt;run build:prod&lt;/arguments&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                                &lt;/configuration&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                            &lt;/execution&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                        &lt;/executions&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                    &lt;/plugin&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                &lt;/plugins&gt;--&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

]]></content>
  </entry>
  <entry>
    <title>Flink Timer定时器</title>
    <url>/posts/20230724172424-e9455fee.html</url>
    <content><![CDATA[<p>在使用processFunction实现两张事实表的JOIN操作时，接触到了Timer，下面对Flink定时器的核心知识做一个简单总结：</p>
<h3 id="1-1-Timers支持使用在KeyedStream"><a href="#1-1-Timers支持使用在KeyedStream" class="headerlink" title="1.1 Timers支持使用在KeyedStream"></a>1.1 Timers支持使用在KeyedStream</h3><p>因为 Timer 是基于每个键即 key 注册并触发，所以 KeyedStream 是 Timer 在 Flink 中使用的先决条件</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ctx.timerService.deleteEventTimeTimer(timeStamp)</span><br></pre></td></tr></table></figure>

<h3 id="1-2-Timers的唯一性"><a href="#1-2-Timers的唯一性" class="headerlink" title="1.2 Timers的唯一性"></a>1.2 Timers的唯一性</h3><p>TimerService 会自动消除计时器的重复数据，始终保持每个键 key 最多只有一个计时器，当一个键 key 注册多个 Timer 计时器时，onTimer 方法只会调用一次，重复注册会覆盖之前的 timer 注册</p>
<h3 id="1-3-Timers支持checkpoint"><a href="#1-3-Timers支持checkpoint" class="headerlink" title="1.3 Timers支持checkpoint"></a>1.3 Timers支持checkpoint</h3><p>ValueState 可以通过 checkpoint 进行检查点保存和恢复，同理 Timer 也可以由 checkpoint 托管，从 Flink checkpoint 检查点恢复任务时，将立即启动恢复前应启动的处于恢复状态的每个已注册计时器，这也提高了 Timer 的容错性</p>
<h3 id="1-4-Timers支持被删除"><a href="#1-4-Timers支持被删除" class="headerlink" title="1.4 Timers支持被删除"></a>1.4 Timers支持被删除</h3><p>从 Flink 1.6.x 开始，计时器可以暂停和删除，提供更便捷的 Timer 处理方式</p>
<p>文章发布自：[Flink Timer 与 TimerService 源码分析与详解](<a href="https://it.cha138.com/ios/show-36808.html#2.1">https://it.cha138.com/ios/show-36808.html#2.1</a> 注册 Timer)</p>
<p>写的十分好，推荐阅读，除此之外推荐阅读：</p>
<p><a href="https://it.cha138.com/mysql/show-110719.html">Flink Timer 机制原理，源码整理</a></p>
<p><a href="https://it.cha138.com/shida/show-452473.html">Flink的定时器EventTime和ProcessTime</a></p>
<p><a href="https://blog.csdn.net/weixin_43923463/article/details/128043877">Flink使用CoProcessFunction完成实时对账、基于时间的双流join_flink实时对账</a></p>
]]></content>
  </entry>
  <entry>
    <title>Doris使用踩坑总结</title>
    <url>/posts/20230328125112-f144fb4b.html</url>
    <content><![CDATA[<p>环境</p>
<ul>
<li>MacBook Pro (13-inch, 2020, Four Thunderbolt 3 ports)</li>
<li>[Doris](<a href="https://doris.apache.org/zh-CN/docs/dev/install/construct-docker/run-docker-cluster/">部署 Docker 集群 - Apache Doris</a>):v1.12.1</li>
<li><a href="https://www.oracle.com/technetwork/java/javase/downloads/index.html">JDK</a>: v1.8.x</li>
<li>IDEA开发环境</li>
</ul>
<h3 id="一、-Docker部署"><a href="#一、-Docker部署" class="headerlink" title="一、 Docker部署"></a>一、 Docker部署</h3><p>官方提供文档<a href="https://doris.apache.org/zh-CN/docs/dev/install/construct-docker/run-docker-cluster/">Deploy Docker cluster</a></p>
<p><font color="red">但部署完以后发现集群无法识别BE节点，查看日志发现是因为没有设置<code>vm.max_map_count</code>参数</font></p>
<blockquote>
<p>避坑1: 需要设置sysctl -w vm.max_map_count=2000000</p>
<p>避坑2: 在启动容器时需要添加privileged: true</p>
</blockquote>
<h3 id="二、Flink-写入Doris"><a href="#二、Flink-写入Doris" class="headerlink" title="二、Flink 写入Doris"></a>二、Flink 写入Doris</h3><p>官方提供了文档<a href="https://doris.apache.org/zh-CN/docs/dev/ecosystem/flink-doris-connector?_highlight=flink">Flink Doris Connector</a></p>
<p>这里选用的是RowData的方式写入到Doris，提前到Doris中创建表代码如下:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE dwd;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> dwd.TICKET;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> dwd.TICKET (</span><br><span class="line">        event <span class="type">VARCHAR</span>(<span class="number">256</span>),</span><br><span class="line">        newval <span class="type">VARCHAR</span>(<span class="number">256</span>),</span><br><span class="line">        oldval <span class="type">VARCHAR</span>(<span class="number">256</span>),</span><br><span class="line">        stamp <span class="type">VARCHAR</span>(<span class="number">256</span>),</span><br><span class="line">        subevent <span class="type">VARCHAR</span>(<span class="number">256</span>),</span><br><span class="line">        uptm <span class="type">VARCHAR</span>(<span class="number">256</span>),</span><br><span class="line">        uptmms <span class="type">VARCHAR</span>(<span class="number">256</span>),</span><br><span class="line">        ver <span class="type">VARCHAR</span>(<span class="number">256</span>)</span><br><span class="line">)DISTRIBUTED <span class="keyword">BY</span> HASH(stamp) BUCKETS <span class="number">1</span></span><br><span class="line">PROPERTIES (</span><br><span class="line">&quot;replication_allocation&quot; <span class="operator">=</span> &quot;tag.location.default: 1&quot;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>然后是使用Java代码:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">StreamExecutionEnvironment</span> <span class="variable">env</span> <span class="operator">=</span> StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">        env.setParallelism(<span class="number">1</span>);</span><br><span class="line">        <span class="type">Properties</span> <span class="variable">prop</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        prop.setProperty(<span class="string">&quot;format&quot;</span>, <span class="string">&quot;json&quot;</span>);</span><br><span class="line">        prop.setProperty(<span class="string">&quot;strip_outer_array&quot;</span>, <span class="string">&quot;true&quot;</span>);</span><br><span class="line"></span><br><span class="line">        env.fromElements(<span class="string">&quot;&#123;\&quot;event\&quot;:\&quot;CheckIn\&quot;,\&quot;newval\&quot;:\&quot;90\&quot;,\&quot;oldval\&quot;:\&quot;0\&quot;,\&quot;stamp\&quot;:\&quot;67100c4f-0355-4dba-8a76-2a94202132d1\&quot;,\&quot;subevent\&quot;:\&quot;\&quot;,\&quot;uptm\&quot;:\&quot;20230319094822\&quot;,\&quot;uptmms\&quot;:\&quot;20230319094822031\&quot;,\&quot;ver\&quot;:\&quot;v1.0\&quot;&#125;&quot;</span>)</span><br><span class="line">                .addSink(DorisSink.sink(</span><br><span class="line">                        DorisReadOptions.builder().build(),</span><br><span class="line">                        DorisExecutionOptions.builder().setBatchSize(<span class="number">3</span>)</span><br><span class="line">                                .setBatchIntervalMs(<span class="number">0L</span>)</span><br><span class="line">                                .setMaxRetries(<span class="number">3</span>)</span><br><span class="line">                                .setStreamLoadProp(prop)</span><br><span class="line">                                .build(),</span><br><span class="line">                        DorisOptions.builder().setFenodes(<span class="string">&quot;localhost:8030&quot;</span>)</span><br><span class="line">                                .setTableIdentifier(<span class="string">&quot;dwd.TICKET&quot;</span>)</span><br><span class="line">                                .setUsername(<span class="string">&quot;admin&quot;</span>)</span><br><span class="line">                                .setPassword(<span class="string">&quot;&quot;</span>).build())</span><br><span class="line">                );</span><br><span class="line">        env.execute(<span class="string">&quot;pss-format-job&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><font color="red">运行时发现网络不通问题，无法成功写入Dois</font>，具体错误如图下图所示：</p>
<p><img src="https://hoey-images.oss-cn-hangzhou.aliyuncs.com/img/image-20230328131103501.png" alt="image-20230328131103501"></p>
<p>分析宿主节点和docker集群的关系</p>
<p><img src="https://hoey-images.oss-cn-hangzhou.aliyuncs.com/img/image-20230328131607049.png" alt="image-20230328131607049"></p>
<p>由架构图得知，是因为sink写入的时候通过外网地址的fe取到be地址是内网地址。</p>
<p>解决思路：</p>
<ol>
<li><p>程序上传到FE运行，但是我属于本地开发环境，这种方式不适合</p>
</li>
<li><p>配置Docker network，使得在宿主节点能够访问容器 BE的IP。这块我也尝试搜索了很多资料，最终以失败告终。</p>
<ul>
<li>尝试一： 在宿主节点修改路由表 sudo route add -net 172.20.80.0/24 172.20.80.1</li>
<li>尝试二： 以Host方式运行FE和BE</li>
</ul>
</li>
<li><p>修改源代码： 找到涉及到“第二步：将BE内网IP返回给主程序”代码，并修改</p>
</li>
</ol>
<p>其中我是用第三种方法，成功在本地开发环境摄入数据到Doris，在这里简单介绍一下快速修改源码的方法。</p>
<p>第一步： 先找到涉及到代码的相关方法，在该场景中对应的是<code>org.apache.doris.flink.rest.RestService</code>类的<code>randomBackend()</code>。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@VisibleForTesting</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">randomBackend</span><span class="params">(DorisOptions options, DorisReadOptions readOptions, Logger logger)</span> <span class="keyword">throws</span> DorisException, IOException &#123;</span><br><span class="line">        List&lt;BackendRowV2&gt; backends = getBackendsV2(options, readOptions, logger);</span><br><span class="line">        logger.trace(<span class="string">&quot;Parse beNodes &#x27;&#123;&#125;&#x27;.&quot;</span>, backends);</span><br><span class="line">        <span class="keyword">if</span> (backends != <span class="literal">null</span> &amp;&amp; !backends.isEmpty()) &#123;</span><br><span class="line">            Collections.shuffle(backends);</span><br><span class="line">            <span class="type">BackendRowV2</span> <span class="variable">backend</span> <span class="operator">=</span> (BackendRowV2)backends.get(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">return</span> backend.getIp() + <span class="string">&quot;:&quot;</span> + backend.getHttpPort();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;argument &#x27;&#123;&#125;&#x27; is illegal, value is &#x27;&#123;&#125;&#x27;.&quot;</span>, <span class="string">&quot;beNodes&quot;</span>, backends);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;beNodes&quot;</span>, String.valueOf(backends));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>第二步：现在希望返回值并非BE的内网IP，因此我们需要将<code>return</code>的内容写死<code>return &quot;localhost:8040&quot;;</code></p>
<p>第三步：在代码中我们创建与类相同的包，并将源码原封不动粘贴进去，如果报错，可以修改。紧接着修改<code>return &quot;localhost:8040&quot;;</code>即可</p>
<p><img src="https://hoey-images.oss-cn-hangzhou.aliyuncs.com/img/image-20230328133408579.png" alt="image-20230328133408579"></p>
<p>总结：</p>
<p>我这里是本地开发环境遇到的问题，并非生产环境；如果生产环境部署基于Doris的应用程序，则需要注意下下面几点：</p>
<ol>
<li>运行的代码所在的机器，必须与Doris所在的网络保持通常。</li>
<li>基于RowData的摄入方式不太友好，现在仍要寻找一种更好的编码方式。</li>
</ol>
]]></content>
  </entry>
  <entry>
    <title>ES操作模版</title>
    <url>/posts/20231108093604-8614bb4c.html</url>
    <content><![CDATA[<p>下面是一些ES日常操作，记录下来方便查询</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#查看集群的健康情况</span><br><span class="line">GET /_cat/health?v</span><br><span class="line"></span><br><span class="line">#查看节点的情况</span><br><span class="line">GET /_cat/nodes?v</span><br><span class="line"></span><br><span class="line">#查询各个索引状态</span><br><span class="line">GET /_cat/indices?v</span><br><span class="line"></span><br><span class="line">#创建索引</span><br><span class="line">PUT /movie_index</span><br><span class="line"></span><br><span class="line">#查看某一个索引的分片情况</span><br><span class="line">GET /_cat/shards/movie_index?v</span><br><span class="line"></span><br><span class="line">#删除索引</span><br><span class="line">DELETE /movie_index</span><br><span class="line"></span><br><span class="line">#创建文档</span><br><span class="line">PUT /movie_index/movie/1</span><br><span class="line">&#123; &quot;id&quot;:100,</span><br><span class="line">  &quot;name&quot;:&quot;operation red sea&quot;,</span><br><span class="line">  &quot;doubanScore&quot;:8.5,</span><br><span class="line">  &quot;actorList&quot;:[  </span><br><span class="line">  &#123;&quot;id&quot;:1,&quot;name&quot;:&quot;zhang yi&quot;&#125;,</span><br><span class="line">  &#123;&quot;id&quot;:2,&quot;name&quot;:&quot;hai qing&quot;&#125;,</span><br><span class="line">  &#123;&quot;id&quot;:3,&quot;name&quot;:&quot;zhang han yu&quot;&#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT /movie_index/movie/2</span><br><span class="line">&#123;</span><br><span class="line">  &quot;id&quot;:200,</span><br><span class="line">  &quot;name&quot;:&quot;operation meigong river&quot;,</span><br><span class="line">  &quot;doubanScore&quot;:8.0,</span><br><span class="line">  &quot;actorList&quot;:[  </span><br><span class="line">&#123;&quot;id&quot;:3,&quot;name&quot;:&quot;zhang han yu&quot;&#125;</span><br><span class="line">]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT /movie_index/movie/3</span><br><span class="line">&#123;</span><br><span class="line">  &quot;id&quot;:300,</span><br><span class="line">  &quot;name&quot;:&quot;incident red sea&quot;,</span><br><span class="line">  &quot;doubanScore&quot;:5.0,</span><br><span class="line">  &quot;actorList&quot;:[  </span><br><span class="line">&#123;&quot;id&quot;:4,&quot;name&quot;:&quot;zhang san feng&quot;&#125;</span><br><span class="line">]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#查询某一个索引中的全部文档</span><br><span class="line">GET /movie_index/_search</span><br><span class="line"></span><br><span class="line">#根据id查询某一个文档</span><br><span class="line">GET /movie_index/movie/3</span><br><span class="line"></span><br><span class="line">#根据文档id，删除某一个文档</span><br><span class="line">DELETE /movie_index/movie/3</span><br><span class="line"></span><br><span class="line">POST /_forcemerge</span><br><span class="line"></span><br><span class="line">#put 对已经存在的文档进行替换(幂等性)</span><br><span class="line">PUT /movie_index/movie/3</span><br><span class="line">&#123;</span><br><span class="line">  &quot;id&quot;:300,</span><br><span class="line">  &quot;name&quot;:&quot;incident red sea&quot;,</span><br><span class="line">  &quot;doubanScore&quot;:5.0,</span><br><span class="line">  &quot;actorList&quot;:[  </span><br><span class="line">&#123;&quot;id&quot;:4,&quot;name&quot;:&quot;zhang cuishan&quot;&#125;</span><br><span class="line">]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#post 进行新增操作，无法保证幂等性</span><br><span class="line">#根据主键保证幂等性</span><br><span class="line">POST /movie_index/movie/</span><br><span class="line">&#123;</span><br><span class="line">  &quot;id&quot;:300,</span><br><span class="line">  &quot;name&quot;:&quot;incident red sea&quot;,</span><br><span class="line">  &quot;doubanScore&quot;:5.0,</span><br><span class="line">  &quot;actorList&quot;:[  </span><br><span class="line">&#123;&quot;id&quot;:4,&quot;name&quot;:&quot;zhang cuishan111&quot;&#125;</span><br><span class="line">]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">GET /movie_index/_search</span><br><span class="line"></span><br><span class="line">GET /movie_index/movie/1</span><br><span class="line"></span><br><span class="line">POST /movie_index/movie/1/_update</span><br><span class="line">&#123;</span><br><span class="line">  &quot;doc&quot;:  &#123; &quot;name&quot;: &quot;新的字段值&quot; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">POST /movie_index/_update_by_query</span><br><span class="line">&#123;</span><br><span class="line">	&quot;query&quot;: &#123;</span><br><span class="line">	  &quot;match&quot;:&#123;</span><br><span class="line">	    &quot;actorList.id&quot;:1</span><br><span class="line">	  &#125;  </span><br><span class="line">	&#125;,</span><br><span class="line">	&quot;script&quot;: &#123;</span><br><span class="line">	  &quot;lang&quot;: &quot;painless&quot;,</span><br><span class="line">	  &quot;source&quot;:&quot;for(int i=0;i&lt;ctx._source.actorList.length;i++)&#123;if(ctx._source.actorList[i].id==3)&#123;ctx._source.actorList[i].name=&#x27;tttt&#x27;&#125;&#125;&quot;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET /movie_index/_search</span><br><span class="line"></span><br><span class="line">POST /movie_index/_delete_by_query</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#批量添加两个document</span><br><span class="line">POST /movie_index/movie/_bulk</span><br><span class="line">&#123;&quot;index&quot;:&#123;&quot;_id&quot;:66&#125;&#125;</span><br><span class="line">&#123;&quot;id&quot;:300,&quot;name&quot;:&quot;incident red sea&quot;,&quot;doubanScore&quot;:5.0,&quot;actorList&quot;:[&#123;&quot;id&quot;:4,&quot;name&quot;:&quot;zhang cuishan&quot;&#125;]&#125;</span><br><span class="line">&#123;&quot;index&quot;:&#123;&quot;_id&quot;:88&#125;&#125;</span><br><span class="line">&#123;&quot;id&quot;:300,&quot;name&quot;:&quot;incident red sea&quot;,&quot;doubanScore&quot;:5.0,&quot;actorList&quot;:[&#123;&quot;id&quot;:4,&quot;name&quot;:&quot;zhang cuishan&quot;&#125;]&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">POST /movie_index/movie/_bulk</span><br><span class="line">&#123;&quot;update&quot;:&#123;&quot;_id&quot;:&quot;66&quot;&#125;&#125;</span><br><span class="line">&#123;&quot;doc&quot;: &#123; &quot;name&quot;: &quot;wudangshanshang&quot; &#125; &#125;</span><br><span class="line">&#123;&quot;delete&quot;:&#123;&quot;_id&quot;:&quot;88&quot;&#125;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#------------------查询操作--------------------</span><br><span class="line">#查询出当前索引中的全部数据</span><br><span class="line">GET /movie_index/_search</span><br><span class="line"></span><br><span class="line">GET /movie_index/_search?q=_id:66</span><br><span class="line"></span><br><span class="line">#查询全部</span><br><span class="line">GET /movie_index/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#根据电影的名称进行查询</span><br><span class="line">GET /movie_index/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;name&quot;: &quot;operation red sea&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET /movie_index</span><br><span class="line"></span><br><span class="line">#按分词进行查询</span><br><span class="line">GET /movie_index/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;actorList.name&quot;: &quot;zhang han yu&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#按短语查询  相当于like </span><br><span class="line">GET /movie_index/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_phrase&quot;: &#123;</span><br><span class="line">      &quot;actorList.name&quot;: &quot;zhang han yu&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#不分词 通过精准匹配进行查询  term精准匹配</span><br><span class="line">GET /movie_index/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;term&quot;: &#123;</span><br><span class="line">       &quot;actorList.name.keyword&quot;:&quot;zhang han yu&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#容错匹配</span><br><span class="line">GET /movie_index/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;fuzzy&quot;: &#123;</span><br><span class="line">      &quot;name&quot;: &quot;radd&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#先匹配 再过滤</span><br><span class="line">GET /movie_index/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;name&quot;: &quot;red&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, </span><br><span class="line">  &quot;post_filter&quot;: &#123;</span><br><span class="line">    &quot;term&quot;: &#123;</span><br><span class="line">      &quot;actorList.id&quot;: &quot;3&quot;</span><br><span class="line">    &#125;  </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#匹配和过滤同时</span><br><span class="line">GET /movie_index/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;match&quot;: &#123;</span><br><span class="line">            &quot;name&quot;: &quot;red&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ], </span><br><span class="line">      &quot;filter&quot;: &#123;</span><br><span class="line">        &quot;term&quot;: &#123;</span><br><span class="line">          &quot;actorList.id&quot;: &quot;3&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#范围过滤  ，将豆瓣评分在6到9的文档查询出来</span><br><span class="line">GET /movie_index/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;range&quot;: &#123;</span><br><span class="line">      &quot;doubanScore&quot;: &#123;</span><br><span class="line">        &quot;gte&quot;: 6,</span><br><span class="line">        &quot;lte&quot;: 9</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#按照豆瓣评分降序排序</span><br><span class="line">GET /movie_index/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;name&quot;: &quot;red&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, </span><br><span class="line">  &quot;sort&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;doubanScore&quot;: &#123;</span><br><span class="line">        &quot;order&quot;: &quot;asc&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#分页查询</span><br><span class="line">GET /movie_index/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;from&quot;: 0,</span><br><span class="line">  &quot;size&quot;: 2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#查询指定字段</span><br><span class="line">GET /movie_index/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;_source&quot;: [&quot;name&quot;, &quot;doubanScore&quot;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#高亮显示</span><br><span class="line">GET /movie_index/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;name&quot;: &quot;red&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;highlight&quot;: &#123;</span><br><span class="line">    &quot;fields&quot;:  &#123;&quot;name&quot;:&#123;&#125; &#125;,</span><br><span class="line">    &quot;pre_tags&quot;: &quot;&lt;a&gt;&quot;,</span><br><span class="line">    &quot;post_tags&quot;: &quot;&lt;/a&gt;&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#需求1：取出每个演员共参演了多少部电影</span><br><span class="line">#aggs 聚合</span><br><span class="line">#term  精准匹配</span><br><span class="line">#terms 聚合操作，相当于groupBy  </span><br><span class="line">GET /movie_index/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;aggs&quot;: &#123;</span><br><span class="line">    &quot;myAggs&quot;: &#123;</span><br><span class="line">      &quot;terms&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;actorList.name.keyword&quot;,</span><br><span class="line">        &quot;size&quot;: 10</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#需求2：每个演员参演电影的平均分是多少，并按评分排序</span><br><span class="line"></span><br><span class="line">GET /movie_index/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;aggs&quot;: &#123;</span><br><span class="line">    &quot;groupByName&quot;: &#123;</span><br><span class="line">      &quot;terms&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;actorList.name.keyword&quot;,</span><br><span class="line">        &quot;size&quot;: 10,</span><br><span class="line">        &quot;order&quot;: &#123;</span><br><span class="line">          &quot;avg_score&quot;: &quot;asc&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;aggs&quot;: &#123;</span><br><span class="line">        &quot;avg_score&quot;: &#123;</span><br><span class="line">          &quot;avg&quot;: &#123;</span><br><span class="line">            &quot;field&quot;: &quot;doubanScore&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#分词</span><br><span class="line">#英文默认分词规则</span><br><span class="line">GET /_analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;text&quot;: &quot;hello world&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#中文默认分词规则</span><br><span class="line">GET /_analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;text&quot;: &quot;蓝瘦香菇&quot;,</span><br><span class="line">  &quot;analyzer&quot;: &quot;ik_smart&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET /_analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;text&quot;: &quot;蓝瘦香菇&quot;,</span><br><span class="line">  &quot;analyzer&quot;: &quot;ik_max_word&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">GET /movie_index</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#自动定义mapping</span><br><span class="line">PUT /movie_chn_1/movie/1</span><br><span class="line">&#123; &quot;id&quot;:1,</span><br><span class="line">  &quot;name&quot;:&quot;红海行动&quot;,</span><br><span class="line">  &quot;doubanScore&quot;:8.5,</span><br><span class="line">  &quot;actorList&quot;:[  </span><br><span class="line">  &#123;&quot;id&quot;:1,&quot;name&quot;:&quot;张译&quot;&#125;,</span><br><span class="line">  &#123;&quot;id&quot;:2,&quot;name&quot;:&quot;海清&quot;&#125;,</span><br><span class="line">  &#123;&quot;id&quot;:3,&quot;name&quot;:&quot;张涵予&quot;&#125;</span><br><span class="line"> ]</span><br><span class="line">&#125;</span><br><span class="line">PUT /movie_chn_1/movie/2</span><br><span class="line">&#123;</span><br><span class="line">  &quot;id&quot;:2,</span><br><span class="line">  &quot;name&quot;:&quot;湄公河行动&quot;,</span><br><span class="line">  &quot;doubanScore&quot;:8.0,</span><br><span class="line">  &quot;actorList&quot;:[  </span><br><span class="line">&#123;&quot;id&quot;:3,&quot;name&quot;:&quot;张涵予&quot;&#125;</span><br><span class="line">]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT /movie_chn_1/movie/3</span><br><span class="line">&#123;</span><br><span class="line">  &quot;id&quot;:3,</span><br><span class="line">  &quot;name&quot;:&quot;红海事件&quot;,</span><br><span class="line">  &quot;doubanScore&quot;:5.0,</span><br><span class="line">  &quot;actorList&quot;:[  </span><br><span class="line">&#123;&quot;id&quot;:4,&quot;name&quot;:&quot;张三丰&quot;&#125;</span><br><span class="line">]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET /movie_chn_1/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;name&quot;: &quot;海行&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET /movie_chn_1/_mapping</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#自定义mapping</span><br><span class="line">DELETE movie_chn_2</span><br><span class="line"></span><br><span class="line">PUT movie_chn_2</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;movie&quot;:&#123;</span><br><span class="line">      &quot;properties&quot;: &#123;</span><br><span class="line">        &quot;id&quot;:&#123;</span><br><span class="line">          &quot;type&quot;: &quot;long&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;name&quot;:&#123;</span><br><span class="line">          &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;doubanScore&quot;:&#123;</span><br><span class="line">          &quot;type&quot;: &quot;double&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;actorList&quot;:&#123;</span><br><span class="line">          &quot;properties&quot;: &#123;</span><br><span class="line">            &quot;id&quot;:&#123;</span><br><span class="line">              &quot;type&quot;:&quot;long&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;name&quot;:&#123;</span><br><span class="line">              &quot;type&quot;:&quot;keyword&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PUT /movie_chn_2/movie/1</span><br><span class="line">&#123; &quot;id&quot;:1,</span><br><span class="line">  &quot;name&quot;:&quot;红海行动&quot;,</span><br><span class="line">  &quot;doubanScore&quot;:8.5,</span><br><span class="line">  &quot;actorList&quot;:[  </span><br><span class="line">  &#123;&quot;id&quot;:1,&quot;name&quot;:&quot;张译&quot;&#125;,</span><br><span class="line">  &#123;&quot;id&quot;:2,&quot;name&quot;:&quot;海清&quot;&#125;,</span><br><span class="line">  &#123;&quot;id&quot;:3,&quot;name&quot;:&quot;张涵予&quot;&#125;</span><br><span class="line"> ]</span><br><span class="line">&#125;</span><br><span class="line">PUT /movie_chn_2/movie/2</span><br><span class="line">&#123;</span><br><span class="line">  &quot;id&quot;:2,</span><br><span class="line">  &quot;name&quot;:&quot;湄公河行动&quot;,</span><br><span class="line">  &quot;doubanScore&quot;:8.0,</span><br><span class="line">  &quot;actorList&quot;:[  </span><br><span class="line">&#123;&quot;id&quot;:3,&quot;name&quot;:&quot;张涵予&quot;&#125;</span><br><span class="line">]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT /movie_chn_2/movie/3</span><br><span class="line">&#123;</span><br><span class="line">  &quot;id&quot;:3,</span><br><span class="line">  &quot;name&quot;:&quot;红海事件&quot;,</span><br><span class="line">  &quot;doubanScore&quot;:5.0,</span><br><span class="line">  &quot;actorList&quot;:[  </span><br><span class="line">&#123;&quot;id&quot;:4,&quot;name&quot;:&quot;张三丰&quot;&#125;</span><br><span class="line">]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET /movie_chn_2/_mapping</span><br><span class="line"></span><br><span class="line">GET /movie_chn_2/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;name&quot;: &quot;海行&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">POST /_reindex</span><br><span class="line">&#123;</span><br><span class="line">  &quot;source&quot;: &#123;&#125;</span><br><span class="line">  , &quot;dest&quot;: &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#创建索引  并指定别名</span><br><span class="line">PUT movie_chn_3</span><br><span class="line">&#123;</span><br><span class="line">  &quot;aliases&quot;: &#123;</span><br><span class="line">      &quot;movie_chn_3_aliase&quot;: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;movie&quot;:&#123;</span><br><span class="line">      &quot;properties&quot;: &#123;</span><br><span class="line">        &quot;id&quot;:&#123;</span><br><span class="line">          &quot;type&quot;: &quot;long&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;name&quot;:&#123;</span><br><span class="line">          &quot;type&quot;: &quot;text&quot;, </span><br><span class="line">          &quot;analyzer&quot;: &quot;ik_smart&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;doubanScore&quot;:&#123;</span><br><span class="line">          &quot;type&quot;: &quot;double&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;actorList&quot;:&#123;</span><br><span class="line">          &quot;properties&quot;: &#123;</span><br><span class="line">            &quot;id&quot;:&#123;</span><br><span class="line">              &quot;type&quot;:&quot;long&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;name&quot;:&#123;</span><br><span class="line">              &quot;type&quot;:&quot;keyword&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">GET /_cat/indices</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">GET /_cat/aliases</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">POST /_aliases</span><br><span class="line">&#123;</span><br><span class="line">  &quot;actions&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;add&quot;: &#123;</span><br><span class="line">        &quot;index&quot;: &quot;movie_chn_3&quot;,</span><br><span class="line">        &quot;alias&quot;: &quot;movie_chn_3_a2&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">GET /movie_chn_3/_search</span><br><span class="line"></span><br><span class="line">GET /movie_chn_3_a2/_search</span><br><span class="line"></span><br><span class="line">GET /_cat/aliases</span><br><span class="line"></span><br><span class="line">POST /_aliases</span><br><span class="line">&#123;</span><br><span class="line">  &quot;actions&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;remove&quot;: &#123;&quot;index&quot;: &quot;movie_chn_3&quot;,&quot;alias&quot;: &quot;movie_chn_3_a2&quot;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">GET /movie_chn_1/_search</span><br><span class="line"></span><br><span class="line">GET /movie_chn_2/_search</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">POST  _aliases</span><br><span class="line">&#123;</span><br><span class="line">    &quot;actions&quot;: [</span><br><span class="line">        &#123; &quot;add&quot;:    &#123; &quot;index&quot;: &quot;movie_chn_1&quot;, &quot;alias&quot;: &quot;movie_chn_query&quot; &#125;&#125;,</span><br><span class="line">        &#123; &quot;add&quot;:    &#123; &quot;index&quot;: &quot;movie_chn_2&quot;, &quot;alias&quot;: &quot;movie_chn_query&quot; &#125;&#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">GET /movie_chn_query/_search</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">POST  _aliases</span><br><span class="line">&#123;</span><br><span class="line">    &quot;actions&quot;: [</span><br><span class="line">        &#123; </span><br><span class="line">          &quot;add&quot;:    </span><br><span class="line">          &#123; </span><br><span class="line">            &quot;index&quot;: &quot;movie_chn_1&quot;, </span><br><span class="line">            &quot;alias&quot;: &quot;movie_chn_1_sub_query&quot;,</span><br><span class="line">            &quot;filter&quot;: &#123;</span><br><span class="line">                &quot;term&quot;: &#123;  &quot;actorList.id&quot;: &quot;4&quot;&#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET /movie_chn_1_sub_query/_search</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">POST /_aliases</span><br><span class="line">&#123;</span><br><span class="line">    &quot;actions&quot;: [</span><br><span class="line">        &#123; &quot;remove&quot;: &#123; &quot;index&quot;: &quot;movie_chn_1&quot;, &quot;alias&quot;: &quot;movie_chn_query&quot; &#125;&#125;,</span><br><span class="line">        &#123; &quot;remove&quot;: &#123; &quot;index&quot;: &quot;movie_chn_2&quot;, &quot;alias&quot;: &quot;movie_chn_query&quot; &#125;&#125;,</span><br><span class="line">        &#123; &quot;add&quot;:    &#123; &quot;index&quot;: &quot;movie_chn_3&quot;, &quot;alias&quot;: &quot;movie_chn_query&quot; &#125;&#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#创建模板</span><br><span class="line">PUT _template/template_movie0523</span><br><span class="line">&#123;</span><br><span class="line">  &quot;index_patterns&quot;: [&quot;movie_test*&quot;],                  </span><br><span class="line">  &quot;settings&quot;: &#123;                                               </span><br><span class="line">    &quot;number_of_shards&quot;: 1</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;aliases&quot; : &#123; </span><br><span class="line">    &quot;&#123;index&#125;-query&quot;: &#123;&#125;,</span><br><span class="line">    &quot;movie_test-query&quot;:&#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;mappings&quot;: &#123;                                          </span><br><span class="line">    &quot;_doc&quot;: &#123;</span><br><span class="line">      &quot;properties&quot;: &#123;</span><br><span class="line">        &quot;id&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;movie_name&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">          &quot;analyzer&quot;: &quot;ik_smart&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">POST movie_test_202010/_doc</span><br><span class="line">&#123;</span><br><span class="line">  &quot;id&quot;:&quot;333&quot;,</span><br><span class="line">  &quot;name&quot;:&quot;zhang3&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET /movie_test_202010-query/_mapping</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">GET /_cat/templates</span><br><span class="line"></span><br><span class="line">GET /_template/template_movie*</span><br></pre></td></tr></table></figure>



]]></content>
  </entry>
  <entry>
    <title>Hexo隐藏文章</title>
    <url>/posts/20221212095216-1c5dc392.html</url>
    <content><![CDATA[<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>在站点根目录下执行</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cnpm install hexo-hide-posts --save</span><br></pre></td></tr></table></figure>

<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>在站点目录下的<code>_config.yml</code>中如下配置：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">hexo-hide-posts</span></span><br><span class="line">hide_posts:</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">可以改成其他你喜欢的名字</span></span><br><span class="line">  filter: hidden</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">指定你想要传递隐藏文章的位置，比如让所有隐藏文章在存档页面可见</span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">常见的位置有：index, tag, category, archive, sitemap, feed, etc.</span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">留空则默认全部隐藏</span></span><br><span class="line">  public_generators: []</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">为隐藏的文章添加 noindex meta 标签，阻止搜索引擎收录</span></span><br><span class="line">  noindex: true</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>在文章的属性中定义 <code>hidden: true</code> 即可隐藏文章。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">title: hidden test</span><br><span class="line">date: 2022-12-12 09:49:19</span><br><span class="line">hidden: true</span><br><span class="line">---</span><br></pre></td></tr></table></figure>

<p>虽然首页上被隐藏了，但你仍然可以通过 <code>https://hexo.test/lorem-ipsum/</code> 链接访问它。</p>
<p>你可以在命令行运行 <code>hexo hidden:list</code> 来获取当前所有的已隐藏文章列表。</p>
<p>参考blog：<a href="https://www.cnblogs.com/yangstar/articles/16690342.html">https://www.cnblogs.com/yangstar/articles/16690342.html</a></p>
]]></content>
  </entry>
  <entry>
    <title>Mac下VIM配置</title>
    <url>/posts/20221208222030-7a63f10c.html</url>
    <content><![CDATA[<h1 id="安装gruvbox主题"><a href="#安装gruvbox主题" class="headerlink" title="安装gruvbox主题"></a>安装gruvbox主题</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir -p ~/.vim/colors ; cd ~/.vim/colors</span><br><span class="line">curl -O https://raw.githubusercontent.com/morhetz/gruvbox/blob/master/colors/gruvbox.vim</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vim ~/.vimrc</span><br><span class="line">&quot;********************************gruvbox主题******************************&quot;</span><br><span class="line">call plug#begin()</span><br><span class="line">Plug &#x27;morhetz/gruvbox&#x27;</span><br><span class="line">call plug#end()</span><br><span class="line">colorscheme gruvbox</span><br><span class="line">set background=dark</span><br></pre></td></tr></table></figure>

<p>执行完成以后，重新运行vim查看效果。</p>
<h1 id="vimrc其他设置"><a href="#vimrc其他设置" class="headerlink" title="vimrc其他设置"></a>vimrc其他设置</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">&quot;********************************基本设置******************************&quot;</span><br><span class="line">set tabstop=4                &quot; 设置tab键的宽度</span><br><span class="line">set shiftwidth=4             &quot; 换行时行间交错使用4个空格</span><br><span class="line">set autoindent               &quot; 自动对齐</span><br><span class="line">set backspace=2              &quot; 设置退格键可用</span><br><span class="line">set shiftwidth=4     		 &quot; 自动缩进4空格</span><br><span class="line">set smartindent              &quot; 智能自动缩进</span><br><span class="line">set number                   &quot; 在每一行最前面显示行号</span><br><span class="line">set showmatch                &quot; 高亮显示对应的括号</span><br><span class="line">set mouse=a                  &quot; 启用鼠标</span><br><span class="line">set ruler                    &quot; 在编辑过程中，在右下角显示光标位置的状态行</span><br><span class="line">set cursorline               &quot; 突出显示当前行</span><br><span class="line">set noswapfile               &quot; 设置无交换区文件&quot;</span><br><span class="line">set writebackup              &quot; 设置无备份文件</span><br><span class="line">set nobackup                 &quot; 设置无备份文件</span><br><span class="line">set autochdir                &quot; 设定文件浏览器目录为当前目录</span><br><span class="line">set foldmethod=syntax        &quot; 选择代码折叠类型</span><br><span class="line">set laststatus=2             &quot; 开启状态栏信息</span><br><span class="line">set cmdheight=2              &quot; 命令行的高度，默认为1，这里设为2</span><br><span class="line">set autoread                 &quot; 当文件在外部被修改，自动更新该文件</span><br><span class="line">set autoread                 &quot; 自动检测并加载外部对文件的修改</span><br><span class="line">set autowrite                &quot; 自动检测并加载外部对文件的修改</span><br><span class="line">set showcmd                  &quot; 在状态行显示目前所执行的命令，未完成的指令片段亦会显示出来</span><br><span class="line">syntax enable                &quot; 打开语法高亮</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if has(&quot;gui_running&quot;)</span><br><span class="line">    set guioptions+=b        &quot; 显示底部滚动条</span><br><span class="line">    set nowrap               &quot; 设置不自动换行</span><br><span class="line">endif</span><br><span class="line"></span><br><span class="line">&quot;********************************设置编码*******************************&quot;</span><br><span class="line">&quot; 设置换行编码</span><br><span class="line">set fileformats=unix,dos,mac</span><br><span class="line">&quot; 设置Vim 内部使用的字符编码方式</span><br><span class="line">set encoding=utf-8</span><br><span class="line">&quot; 设置文件编码</span><br><span class="line">if has(&quot;win32&quot;)</span><br><span class="line">	set fileencoding=chinese</span><br><span class="line">else</span><br><span class="line">	set fileencoding=utf-8</span><br><span class="line">endif</span><br><span class="line">&quot; 解决consle输出乱码</span><br><span class="line">language messages zh_CN.utf-8</span><br></pre></td></tr></table></figure>

]]></content>
  </entry>
  <entry>
    <title>Marquez元数据管理体验</title>
    <url>/posts/20231108111119-4023ca29.html</url>
    <content><![CDATA[<h3 id="Marquez"><a href="#Marquez" class="headerlink" title="Marquez"></a>Marquez</h3><p><img src="https://hoey-images.oss-cn-hangzhou.aliyuncs.com/img/image-20231109105214566.png" alt="image-20231109105214566"></p>
<p><strong>开源地址</strong>：<a href="https://github.com/MarquezProject/marquez">https://github.com/MarquezProject/marquez</a> </p>
<p><strong>Marquez的优点：</strong></p>
<ul>
<li>界面美观，操作细节设计比较棒</li>
<li>部署简单，代码简洁</li>
<li>依靠底层OpenLineage协议，结构较好</li>
</ul>
<p><strong>Marquez的不足：</strong></p>
<ul>
<li>聚焦数据资产/血缘的可视化，数据资产管理的一些功能，需要较多开发工作</li>
</ul>
<p><strong>相关介绍</strong>：<a href="https://mp.weixin.qq.com/s/OMm6QEk9-1bFdYKuimdxCw">https://mp.weixin.qq.com/s/OMm6QEk9-1bFdYKuimdxCw</a></p>
<h2 id="安装及体验"><a href="#安装及体验" class="headerlink" title="安装及体验"></a>安装及体验</h2><ol>
<li>克隆项目</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git clone git@github-hoey94:hoey94/marquez.git</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>到项目根目录运行docker</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">DOCKER_BUILDKIT=1 ./docker/up.sh --seed</span><br></pre></td></tr></table></figure>

<p><img src="https://hoey-images.oss-cn-hangzhou.aliyuncs.com/img/image-20231108111436255.png" alt="image-20231108111436255"></p>
<ol start="3">
<li>访问页面</li>
</ol>
<p><img src="https://hoey-images.oss-cn-hangzhou.aliyuncs.com/img/image-20231108113044028.png" alt="image-20231108113044028"></p>
<ol start="4">
<li>简单实用</li>
</ol>
<p>创建namespace</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl -X POST http://localhost:5000/api/v1/lineage \</span><br><span class="line">-H &#x27;Content-Type: application/json&#x27; \</span><br><span class="line">-d &#x27;&#123;</span><br><span class="line">      &quot;eventType&quot;: &quot;START&quot;,</span><br><span class="line">      &quot;eventTime&quot;: &quot;2020-12-28T19:52:00.001+10:00&quot;,</span><br><span class="line">      &quot;run&quot;: &#123;</span><br><span class="line">        &quot;runId&quot;: &quot;d46e465b-d358-4d32-83d4-df660ff614dd&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;job&quot;: &#123;</span><br><span class="line">        &quot;namespace&quot;: &quot;my-namespace&quot;,</span><br><span class="line">        &quot;name&quot;: &quot;my-job&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;inputs&quot;: [&#123;</span><br><span class="line">        &quot;namespace&quot;: &quot;my-namespace&quot;,</span><br><span class="line">        &quot;name&quot;: &quot;my-input&quot;</span><br><span class="line">      &#125;],  </span><br><span class="line">      &quot;producer&quot;: &quot;https://github.com/OpenLineage/OpenLineage/blob/v1-0-0/client&quot;</span><br><span class="line">    &#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>创建input和output</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl -X POST http://localhost:5000/api/v1/lineage \</span><br><span class="line">-H &#x27;Content-Type: application/json&#x27; \</span><br><span class="line">-d &#x27;&#123;</span><br><span class="line">      &quot;eventType&quot;: &quot;COMPLETE&quot;,</span><br><span class="line">      &quot;eventTime&quot;: &quot;2020-12-28T20:52:00.001+10:00&quot;,</span><br><span class="line">      &quot;run&quot;: &#123;</span><br><span class="line">        &quot;runId&quot;: &quot;d46e465b-d358-4d32-83d4-df660ff614dd&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;job&quot;: &#123;</span><br><span class="line">        &quot;namespace&quot;: &quot;my-namespace&quot;,</span><br><span class="line">        &quot;name&quot;: &quot;my-job&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;outputs&quot;: [&#123;</span><br><span class="line">        &quot;namespace&quot;: &quot;my-namespace&quot;,</span><br><span class="line">        &quot;name&quot;: &quot;my-output&quot;,</span><br><span class="line">        &quot;facets&quot;: &#123;</span><br><span class="line">          &quot;schema&quot;: &#123;</span><br><span class="line">            &quot;_producer&quot;: &quot;https://github.com/OpenLineage/OpenLineage/blob/v1-0-0/client&quot;,</span><br><span class="line">            &quot;_schemaURL&quot;: &quot;https://github.com/OpenLineage/OpenLineage/blob/v1-0-0/spec/OpenLineage.json#/definitions/SchemaDatasetFacet&quot;,</span><br><span class="line">            &quot;fields&quot;: [</span><br><span class="line">              &#123; &quot;name&quot;: &quot;a&quot;, &quot;type&quot;: &quot;VARCHAR&quot;&#125;,</span><br><span class="line">              &#123; &quot;name&quot;: &quot;b&quot;, &quot;type&quot;: &quot;VARCHAR&quot;&#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;],     </span><br><span class="line">      &quot;producer&quot;: &quot;https://github.com/OpenLineage/OpenLineage/blob/v1-0-0/client&quot;</span><br><span class="line">    &#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>更多细节可以参考一下下面文章：<a href="https://blog.csdn.net/weixin_43947468/article/details/129593234">https://blog.csdn.net/weixin_43947468/article/details/129593234</a></p>
]]></content>
  </entry>
  <entry>
    <title>Mac自动SSH+MFA</title>
    <url>/posts/20221208193934-30d40687.html</url>
    <content><![CDATA[<p>因工作需要，使用Iterm2自动跳转远程终端，提高工作效率</p>
<h1 id="自动获取MFA-Token"><a href="#自动获取MFA-Token" class="headerlink" title="自动获取MFA Token"></a>自动获取MFA Token</h1><p>安装oath-toolkit</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">brew search oath-toolkit</span><br><span class="line">brew install oath-toolkit</span><br></pre></td></tr></table></figure>

<p>使用下面命令获取token， 注：${SECKEY} 是一个变量，按照自己的填写</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">alias</span> smCode=<span class="string">&quot;echo `oathtool --totp -b <span class="variable">$&#123;SECKEY&#125;</span> `| pbcopy&quot;</span></span><br></pre></td></tr></table></figure>



<h1 id="自定义SHELL-MFA-TOKEN脚本"><a href="#自定义SHELL-MFA-TOKEN脚本" class="headerlink" title="自定义SHELL+MFA TOKEN脚本"></a>自定义SHELL+MFA TOKEN脚本</h1><p>将脚本保存juneyao_auto_ssh_prd.sh</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">opts=$@</span><br><span class="line">getParam()&#123;</span><br><span class="line">  arg=$1</span><br><span class="line">  echo $opts | xargs -n1 | cut -b 2- | awk -F&#x27;=&#x27; &#x27;&#123;if($1==&quot;&#x27;&quot;$arg&quot;&#x27;&quot;) print $2&#125;&#x27;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">USER=zhaoyihao</span><br><span class="line">echo &quot;[INFO] USER: &quot;$&#123;USER&#125;</span><br><span class="line"></span><br><span class="line">HOST=`getParam HOST`</span><br><span class="line">echo &quot;[INFO] HOST: &quot;$&#123;HOST&#125;</span><br><span class="line"></span><br><span class="line">PASSWORD=`getParam PASSWORD`</span><br><span class="line">echo &quot;[INFO] PASSWORD: *****&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">stg:20 prd:2222</span></span><br><span class="line">PORT=`getParam PORT`</span><br><span class="line">echo &quot;[INFO] PORT: &quot;$&#123;PORT&#125;</span><br><span class="line"></span><br><span class="line">PRD_TOKEN=&quot;`oathtool --totp -b 4YIKKGPXJD3G32YP`&quot;</span><br><span class="line"></span><br><span class="line">sw_login()&#123;</span><br><span class="line">        expect -c &quot;</span><br><span class="line">        # 每个判断等待1秒</span><br><span class="line">        set timeout 1</span><br><span class="line">        spawn ssh $USER@$HOST -p $PORT</span><br><span class="line">        # 判断是否需要保存秘钥</span><br><span class="line">        expect &#123;</span><br><span class="line">                \&quot;yes/no\&quot;   &#123; send yes\n &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        # 判断发送密码</span><br><span class="line">        expect &#123;        </span><br><span class="line">        				\&quot;*assword\&quot; &#123; send $PASSWORD\n &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        # 判断发送验证码</span><br><span class="line">        expect &#123;        </span><br><span class="line">        				\&quot;*OTP Code*\&quot; &#123; send $PRD_TOKEN\n &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        # 停留在当前登录界面</span><br><span class="line">        interact</span><br><span class="line">        &quot;</span><br><span class="line">&#125;</span><br><span class="line">sw_login</span><br></pre></td></tr></table></figure>



<p>脚本的使用命令：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sh juneyao_auto_ssh_prd.sh -HOST=jmp.juneyaoair.com -PORT=2222 -PASSWORD=123123</span><br></pre></td></tr></table></figure>



<h1 id="与ITerm2集成"><a href="#与ITerm2集成" class="headerlink" title="与ITerm2集成"></a>与ITerm2集成</h1><p>在ITerm2终端中进行配置</p>
<p>Preference… -&gt; Profiles -&gt; +</p>
<p><img src="https://hoey-images.oss-cn-hangzhou.aliyuncs.com/img/image-20230105095419303.png" alt="image-20230105095419303"></p>
<p>将脚本运行命令填入到Send text at start:文本框中保存即可。</p>
]]></content>
  </entry>
  <entry>
    <title>hexo换主题乱码问题的解决</title>
    <url>/posts/20221208120419-a0fbf222.html</url>
    <content><![CDATA[<p>使用next主题时运行报错</p>
<h2 id="问题的表现"><a href="#问题的表现" class="headerlink" title="问题的表现"></a>问题的表现</h2><p><code>&#123;% extends '_layout.swig' %&#125; &#123;% import '_macro/post.swig' as post_template %&#125;....................</code></p>
<h2 id="问题原因"><a href="#问题原因" class="headerlink" title="问题原因"></a>问题原因</h2><p>原因是hexo在5.0之后把swig给删除了需要自己手动安装</p>
<h2 id="问题解决"><a href="#问题解决" class="headerlink" title="问题解决"></a>问题解决</h2><figure class="highlight css"><table><tr><td class="code"><pre><span class="line">npm <span class="selector-tag">i</span> hexo-renderer-swig</span><br></pre></td></tr></table></figure>

<p>之后重新</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">hexo clean          </span><br><span class="line">hexo <span class="keyword">generate</span>      </span><br><span class="line">hexo server</span><br></pre></td></tr></table></figure>

]]></content>
  </entry>
  <entry>
    <title>Jellyfin 添加字体库解决中文乱码</title>
    <url>/posts/20230430133503-ff462b52.html</url>
    <content><![CDATA[<p>最近使用Jellyfin搭建家庭影音出现中文乱码问题，下面是我搜到的一些方案，我用的是扩展中文字体库</p>
<ul>
<li>使用nyanmisaka/jellyfin 套件</li>
<li>使用actime转字幕</li>
<li>扩展中文字体库</li>
</ul>
<p>下面是一些指令，针对小白用的，大佬无视</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">远程登录到NAS并切换最高权限</span></span><br><span class="line">ssh admin@192.168.30.5 -p 22</span><br><span class="line">sudo -i</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入到NAS自己创建的目录，这个目录自己改</span></span><br><span class="line">cd /volume1/media/fonts</span><br><span class="line">pwd</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用docker命令查看jellyfin 的<span class="built_in">id</span></span></span><br><span class="line">docker ps</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入到容器内部查看目录文件结构1538f09eaa85要替换成自己的<span class="built_in">id</span></span></span><br><span class="line">docker exec -it 1538f09eaa85 /bin/bash</span><br><span class="line">cd /usr/share/fonts/</span><br><span class="line">exit</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">复制宿主机的文件到容器内</span></span><br><span class="line">docker cp fz.tar.gz 1538f09eaa85:/usr/share/fonts/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">到容器目录中解压</span></span><br><span class="line">docker exec -it 1538f09eaa85 /bin/bash</span><br><span class="line">cd /usr/share/fonts/</span><br><span class="line">tar -zxvf fz.tar.gz</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>链接：<a href="https://share.weiyun.com/5Wg55FF5">https://share.weiyun.com/5Wg55FF5</a> 密码：nhqe76</p>
<p>视频已经传到B站，欢迎观看<a href="https://www.bilibili.com/video/BV1jg4y1L7sR/?vd_source=8054953f896f7243d95be264ebdece29">Jellyfin中文字幕乱码解决_哔哩哔哩_bilibili</a></p>
]]></content>
  </entry>
  <entry>
    <title>github配置多用户</title>
    <url>/posts/20221208121846-ef5df40e.html</url>
    <content><![CDATA[<p>因为需要使用多个github账号，但只有一台电脑，想要动态切换不同用户，并且做到免密提交。</p>
<h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><ul>
<li>Mac book Pro 2020</li>
<li>git version 2.24.3 (Apple Git-128)</li>
<li>github账号</li>
</ul>
<table>
<thead>
<tr>
<th>github登录账号</th>
<th>github用户名</th>
</tr>
</thead>
<tbody><tr>
<td><a href="mailto:&#x63;&#110;&#110;&#x71;&#106;&#98;&#x61;&#110;&#53;&#x32;&#49;&#64;&#x67;&#109;&#x61;&#x69;&#x6c;&#46;&#x63;&#111;&#109;">&#x63;&#110;&#110;&#x71;&#106;&#98;&#x61;&#110;&#53;&#x32;&#49;&#64;&#x67;&#109;&#x61;&#x69;&#x6c;&#46;&#x63;&#111;&#109;</a></td>
<td>hoey94</td>
</tr>
<tr>
<td><a href="mailto:&#51;&#53;&#49;&#x38;&#54;&#53;&#x35;&#55;&#54;&#64;&#113;&#113;&#x2e;&#x63;&#111;&#x6d;">&#51;&#53;&#49;&#x38;&#54;&#53;&#x35;&#55;&#54;&#64;&#113;&#113;&#x2e;&#x63;&#111;&#x6d;</a></td>
<td>hoey1994</td>
</tr>
</tbody></table>
<ul>
<li>测试用的项目(大小写区分)</li>
</ul>
<table>
<thead>
<tr>
<th>Github账号</th>
<th>项目</th>
</tr>
</thead>
<tbody><tr>
<td><a href="mailto:&#99;&#110;&#110;&#x71;&#106;&#x62;&#97;&#x6e;&#x35;&#50;&#49;&#64;&#x67;&#x6d;&#x61;&#105;&#x6c;&#46;&#99;&#111;&#x6d;">&#99;&#110;&#110;&#x71;&#106;&#x62;&#97;&#x6e;&#x35;&#50;&#49;&#64;&#x67;&#x6d;&#x61;&#105;&#x6c;&#46;&#99;&#111;&#x6d;</a></td>
<td>Test</td>
</tr>
<tr>
<td><a href="mailto:&#51;&#x35;&#x31;&#x38;&#x36;&#x35;&#53;&#55;&#x36;&#64;&#113;&#x71;&#46;&#99;&#x6f;&#109;">&#51;&#x35;&#x31;&#x38;&#x36;&#x35;&#53;&#55;&#x36;&#64;&#113;&#x71;&#46;&#99;&#x6f;&#109;</a></td>
<td>test</td>
</tr>
</tbody></table>
<h1 id="免密登录"><a href="#免密登录" class="headerlink" title="免密登录"></a>免密登录</h1><p>为两个账号生成不同的公钥(*.pub)和密钥</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ssh-keygen -t rsa -C &quot;cnnqjban521@gmail.com&quot; -f ~/.ssh/id_rsa_hoey94</span><br><span class="line">ssh-keygen -t rsa -C &quot;351865576@qq.com&quot; -f ~/.ssh/id_rsa_hoey1994</span><br></pre></td></tr></table></figure>

<p>生成的两组，公钥和密钥，分别到github官网上配置免密登录 Settings-&gt;SSH and GPG Keys-&gt;New SSH Key，填写的内容可以是用下面命令查看</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat ~/.ssh/id_rsa_hoey94.pub</span><br><span class="line">cat ~/.ssh/id_rsa_hoey1994.pub</span><br></pre></td></tr></table></figure>



<h1 id="配置映射"><a href="#配置映射" class="headerlink" title="配置映射"></a>配置映射</h1><p>创建~/.ssh/config，将内容填入进去</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim ~/.ssh/config</span><br><span class="line"></span><br><span class="line">Host github-hoey1994</span><br><span class="line">HostName github.com</span><br><span class="line">IdentityFile ~/.ssh/id_rsa_hoey1994</span><br></pre></td></tr></table></figure>



<p>这里解释一下这一组内容的含义，平常克隆的时候我们会这么写:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git clone git@github.com:hoey1994/test.git</span><br></pre></td></tr></table></figure>

<p>但如果如果按照上面内容进行配置以后，在克隆的时候要改成这样：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git clone git@github-hoey1994:hoey1994/test.git</span><br></pre></td></tr></table></figure>

<p>请仔细对比一下上面两个克隆命令之间的差异</p>
<p>按照同样原理，将另一个账号也配置一下</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Host github-hoey94</span><br><span class="line">HostName github.com</span><br><span class="line">IdentityFile ~/.ssh/id_rsa_hoey94</span><br></pre></td></tr></table></figure>



<blockquote>
<p>如果端口有修改，可以按照下面的方式进行填写</p>
<p>Host gitlib-juneyao<br>HostName gitlab.juneyaoair.com<br>Port 10022<br>IdentityFile /Users/hoey/.ssh/id_rsa_juneyao</p>
</blockquote>
<h1 id="用户管理"><a href="#用户管理" class="headerlink" title="用户管理"></a>用户管理</h1><p>推荐不要跳过这一步，gacm是管理git用户很不错的一个工具，可以稍微熟悉一下命令。对于commit 的author的信息，可以快速的进行切换，因为本地有多个用户，使用它可以大大提高效率。</p>
<ol>
<li>取消全局的用户配置</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git config --global --unset user.email</span><br><span class="line">git config --global --unset user.mail</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">可以查看内容是否已经取消</span></span><br><span class="line">git config --global -e</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>安装多用户管理工具<a href="https://github.com/hoey94/gacm">gacm</a>，具体安装步骤见github</p>
</li>
<li><p>使用gacm命令添加两个账户</p>
</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gacm add --name hoey94 --email cnnqjban521@gmail.com</span><br><span class="line">gacm add --name hoey1994 --email 351865576@qq.com</span><br></pre></td></tr></table></figure>



<h1 id="测试验证"><a href="#测试验证" class="headerlink" title="测试验证"></a>测试验证</h1><p>在账号<a href="mailto:&#99;&#x6e;&#x6e;&#x71;&#x6a;&#x62;&#97;&#110;&#53;&#50;&#49;&#x40;&#103;&#109;&#x61;&#x69;&#x6c;&#46;&#99;&#x6f;&#109;">&#99;&#x6e;&#x6e;&#x71;&#x6a;&#x62;&#97;&#110;&#53;&#50;&#49;&#x40;&#103;&#109;&#x61;&#x69;&#x6c;&#46;&#99;&#x6f;&#109;</a>(hoey94)下创建Test项目</p>
<p>在账号<a href="mailto:&#x33;&#x35;&#x31;&#x38;&#x36;&#x35;&#x35;&#55;&#54;&#x40;&#x71;&#113;&#46;&#x63;&#111;&#109;">&#x33;&#x35;&#x31;&#x38;&#x36;&#x35;&#x35;&#55;&#54;&#x40;&#x71;&#113;&#46;&#x63;&#111;&#109;</a>(hoey1994)下创建test项目</p>
<p>使用下面命令分别克隆到本地</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">克隆Test</span></span><br><span class="line">git clone git@github-hoey94:hoey94/Test.git</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用gacm切换项目本地用户为hoey94</span></span><br><span class="line">gacm use hoey94 --local</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看项目本地用户是否切换成功</span></span><br><span class="line">gacm ls</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">克隆<span class="built_in">test</span></span></span><br><span class="line">git clone git@github-hoey1994:hoey1994/test.git</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用gacm切换项目本地用户为hoey1994</span></span><br><span class="line">gacm use hoey1994 --local</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看项目本地用户是否切换成功</span></span><br><span class="line">gacm ls</span><br></pre></td></tr></table></figure>



<p>改动一下里面的内容并提交完成测试。</p>
]]></content>
  </entry>
  <entry>
    <title>ksqlDB</title>
    <url>/posts/20230314161612-f30a9b25.html</url>
    <content><![CDATA[<p>目前需要对Kafka Topic中的数据进行分析，查询了一下KSQLDB挺不错，它是一个流处理引擎，主要用于处理实时数据流，并支持 SQL 查询和流处理操作。KSQLDB 可以运行在 Apache Kafka 平台之上，它不需要额外的基础设施，因此可以方便地与 Kafka 进行集成。KSQLDB 可以实现流数据的可视化、数据的清洗和去重、流式计算等。KSQLDB 的主要特点包括易于使用、接近实时的处理速度、强大的 SQL 查询功能以及灵活的流处理操作。</p>
<p>环境准备</p>
<ul>
<li>MacBook Pro (13-inch, 2020, Four Thunderbolt 3 ports)</li>
<li>Docker &amp; Docker compose</li>
</ul>
<p>下面代码用于部署Standalone</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">version: <span class="string">&#x27;2&#x27;</span></span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  zookeeper:</span><br><span class="line">    image: confluentinc/cp-zookeeper:<span class="number">7.3</span>.<span class="number">0</span></span><br><span class="line">    hostname: zookeeper</span><br><span class="line">    container_name: zookeeper</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">&quot;2181:2181&quot;</span></span><br><span class="line">    environment:</span><br><span class="line">      ZOOKEEPER_CLIENT_PORT: <span class="number">2181</span></span><br><span class="line">      ZOOKEEPER_TICK_TIME: <span class="number">2000</span></span><br><span class="line"></span><br><span class="line">  broker:</span><br><span class="line">    image: confluentinc/cp-kafka:<span class="number">7.3</span>.<span class="number">0</span></span><br><span class="line">    hostname: broker</span><br><span class="line">    container_name: broker</span><br><span class="line">    depends_on:</span><br><span class="line">      - zookeeper</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">&quot;29092:29092&quot;</span></span><br><span class="line">    environment:</span><br><span class="line">      KAFKA_BROKER_ID: <span class="number">1</span></span><br><span class="line">      KAFKA_ZOOKEEPER_CONNECT: <span class="string">&#x27;zookeeper:2181&#x27;</span></span><br><span class="line">      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT</span><br><span class="line">      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://broker:<span class="number">9092</span>,PLAINTEXT_HOST://localhost:<span class="number">29092</span></span><br><span class="line">      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: <span class="number">1</span></span><br><span class="line">      KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS: <span class="number">0</span></span><br><span class="line">      KAFKA_TRANSACTION_STATE_LOG_MIN_ISR: <span class="number">1</span></span><br><span class="line">      KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR: <span class="number">1</span></span><br><span class="line"></span><br><span class="line">  ksqldb-server:</span><br><span class="line">    image: confluentinc/ksqldb-server:<span class="number">0.28</span>.<span class="number">3</span></span><br><span class="line">    hostname: ksqldb-server</span><br><span class="line">    container_name: ksqldb-server</span><br><span class="line">    depends_on:</span><br><span class="line">      - broker</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">&quot;8088:8088&quot;</span></span><br><span class="line">    environment:</span><br><span class="line">      KSQL_LISTENERS: http://<span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">8088</span></span><br><span class="line">      KSQL_BOOTSTRAP_SERVERS: broker:<span class="number">9092</span></span><br><span class="line">      KSQL_KSQL_LOGGING_PROCESSING_STREAM_AUTO_CREATE: <span class="string">&quot;true&quot;</span></span><br><span class="line">      KSQL_KSQL_LOGGING_PROCESSING_TOPIC_AUTO_CREATE: <span class="string">&quot;true&quot;</span></span><br><span class="line"></span><br><span class="line">  ksqldb-cli:</span><br><span class="line">    image: confluentinc/ksqldb-cli:<span class="number">0.28</span>.<span class="number">3</span></span><br><span class="line">    container_name: ksqldb-cli</span><br><span class="line">    depends_on:</span><br><span class="line">      - broker</span><br><span class="line">      - ksqldb-server</span><br><span class="line">    <span class="keyword">entrypoint</span><span class="language-bash">: /bin/sh</span></span><br><span class="line">    tty: true</span><br></pre></td></tr></table></figure>

<p>启动KsqlDB服务:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker-compose up</span><br></pre></td></tr></table></figure>

<p>使用Docker链接到Cli中</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker exec -it ksqldb-cli</span><br></pre></td></tr></table></figure>

<p>链接到cli中后，在终端运行命令链接：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[ksqldb-cli] docker exec -it ksqldb-cli ksql http://ksqldb-server:8088</span><br></pre></td></tr></table></figure>

<p>可以运行命令查看topic</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">show topics;</span><br></pre></td></tr></table></figure>

<p>如果你想链接远端Kafka集群，将<KSQL_BOOTSTRAP_SERVERS> 替换成自己的远程Kafka集群，像下面这个dockerfile一样：</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">version: <span class="string">&#x27;2&#x27;</span></span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line"></span><br><span class="line">  ksqldb-server-juneyao:</span><br><span class="line">    image: confluentinc/ksqldb-server</span><br><span class="line">    hostname: ksqldb-server-juneyao</span><br><span class="line">    container_name: ksqldb-server-juneyao</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">&quot;8088:8088&quot;</span></span><br><span class="line">    environment:</span><br><span class="line">      KSQL_LISTENERS: http://<span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">8088</span></span><br><span class="line">      KSQL_BOOTSTRAP_SERVERS: <span class="number">172.22</span>.<span class="number">17.28</span>:<span class="number">9092</span></span><br><span class="line">      KSQL_KSQL_LOGGING_PROCESSING_STREAM_AUTO_CREATE: <span class="string">&quot;true&quot;</span></span><br><span class="line">      KSQL_KSQL_LOGGING_PROCESSING_TOPIC_AUTO_CREATE: <span class="string">&quot;true&quot;</span></span><br><span class="line"></span><br><span class="line">  ksqldb-cli-juneyao:</span><br><span class="line">    image: confluentinc/ksqldb-cli</span><br><span class="line">    container_name: ksqldb-cli-juneyao</span><br><span class="line">    depends_on:</span><br><span class="line">      - ksqldb-server-juneyao</span><br><span class="line">    <span class="keyword">entrypoint</span><span class="language-bash">: /bin/sh</span></span><br><span class="line">    tty: true</span><br></pre></td></tr></table></figure>

<p> 后面的操作和上面都一样了，启动的时候注意修改名称</p>
<p><img src="https://hoey-images.oss-cn-hangzhou.aliyuncs.com/img/image-20230314162231259.png" alt="image-20230314162231259"></p>
<h3 id="Example-1：-创建流表并查询"><a href="#Example-1：-创建流表并查询" class="headerlink" title="Example 1： 创建流表并查询"></a>Example 1： 创建流表并查询</h3><p>展示有多少Topic:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> topics;</span><br><span class="line"><span class="keyword">show</span> streams;</span><br></pre></td></tr></table></figure>

<p>在cli链接后，我们创建一个riderLocations流，如果locations这个topic在kafka中不存在，则会对应创建。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> STREAM riderLocations (</span><br><span class="line">    profileId <span class="type">VARCHAR</span>,</span><br><span class="line">    latitude  <span class="keyword">DOUBLE</span>,</span><br><span class="line">    longitude <span class="keyword">DOUBLE</span></span><br><span class="line">) <span class="keyword">WITH</span> ( kafka_topic<span class="operator">=</span><span class="string">&#x27;locations&#x27;</span>, value_format<span class="operator">=</span><span class="string">&#x27;json&#x27;</span>, PARTITIONS <span class="operator">=</span><span class="number">1</span> );</span><br></pre></td></tr></table></figure>

<p>然后往topic中插入一批数据</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kafka-console-producer --broker-list localhost:9092 --topic locations </span><br><span class="line">&#123;&quot;profileId&quot;:&quot;1&quot;,&quot;latitude&quot;:2.0,&quot;longitude&quot;:1.0&#125;</span><br><span class="line">&#123;&quot;profileId&quot;:&quot;2&quot;,&quot;latitude&quot;:3.0,&quot;longitude&quot;:3.0&#125;</span><br><span class="line">&#123;&quot;profileId&quot;:&quot;3&quot;,&quot;latitude&quot;:1.0,&quot;longitude&quot;:1.0&#125;</span><br></pre></td></tr></table></figure>

<p>就可以愉快的查询它了</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="string">&#x27;auto.offset.reset&#x27;</span><span class="operator">=</span><span class="string">&#x27;earliest&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> riderLocations;</span><br></pre></td></tr></table></figure>

<p>更多的详细用法可以参考网站<a href="https://ksqldb.io/quickstart.html#quickstart-content">ksqldb</a></p>
]]></content>
  </entry>
  <entry>
    <title>mac下的开发包管理工具-sdk</title>
    <url>/posts/20230716095858-f1de28db.html</url>
    <content><![CDATA[<p>SDK可以帮助我们维护mac下的程序包，比如想安装jdk1.8、又想安装jdk11，比如想安装maven等等，它都可以通过指令进行安装和管理。下面是一些常用的指令：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装</span></span><br><span class="line">curl -s &quot;https://get.sdkman.io&quot; | bash</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置path</span></span><br><span class="line">source &quot;$HOME/.sdkman/bin/sdkman-init.sh&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看sdk版本</span></span><br><span class="line">sdk version</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看安装maven安装情况</span></span><br><span class="line">sdk list maven</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装maven 3.6.4</span></span><br><span class="line">sdk install maven  3.6.3</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">maven被安装到的目录</span></span><br><span class="line">cd ~/.sdkman/candidates</span><br></pre></td></tr></table></figure>
]]></content>
  </entry>
  <entry>
    <title>使用反向代理解决SSL认证</title>
    <url>/posts/20230504205542-a6b71998.html</url>
    <content><![CDATA[<p>自己手里有很多私有服务，并且域名还都不一样，例如下面这些：</p>
<table>
<thead>
<tr>
<th>应用</th>
<th>ip</th>
</tr>
</thead>
<tbody><tr>
<td>NAS</td>
<td>192.168.30.5:5000</td>
</tr>
<tr>
<td>Jellyfin</td>
<td>192.168.30.5:8096</td>
</tr>
<tr>
<td>私人笔记</td>
<td>hoey94.github.io</td>
</tr>
<tr>
<td>私人网盘</td>
<td>192.168.30.5:9000</td>
</tr>
<tr>
<td>chatgpt</td>
<td>chat.github.io</td>
</tr>
<tr>
<td>…</td>
<td>…</td>
</tr>
</tbody></table>
<p>这些应用管理起来十分不方便，于是就想将这些网站整合在一起，并且对外提供统一域名访问方式。我自身是有一个免费的顶级域名的hoey.tk，那现在的需求就很明确了，其实就是想得到下面这样的效果：</p>
<table>
<thead>
<tr>
<th>应用</th>
<th>ip</th>
</tr>
</thead>
<tbody><tr>
<td>NAS</td>
<td>nas.hoey.tk</td>
</tr>
<tr>
<td>Jellyfin</td>
<td>jellyfin.hoey.tk</td>
</tr>
<tr>
<td>私人笔记</td>
<td>notes.hoey.tk</td>
</tr>
<tr>
<td>私人网盘</td>
<td>pan.hoey.tk</td>
</tr>
<tr>
<td>chatgpt</td>
<td>chat.hoey.tk</td>
</tr>
<tr>
<td>…</td>
<td>…</td>
</tr>
</tbody></table>
<p>最近找到了一款挺不错的软件<a href="https://github.com/NginxProxyManager/nginx-proxy-manager">Nginx Project Manager</a>，并且还能提供免费的SSL，虽然3个月到期以后还要手动续期，不过白嫖的东西还要什么自行车。它的页面像这样：</p>
<p><img src="https://hoey-images.oss-cn-hangzhou.aliyuncs.com/img/image-20230504205632731.png" alt="image-20230504205632731"></p>
<p>配置完以后，访问的时候只需要使用二级域名访问即可，十分方便，维护起来也十分傻瓜。</p>
<h2 id="前置准备"><a href="#前置准备" class="headerlink" title="前置准备"></a>前置准备</h2><ul>
<li>VPS任意，我的是在国外自购的一台服务器，为什么自购国外，大家懂得都懂，现在是科学时代。</li>
<li>自建家用机服务器，我的服务器主要插上8T*2机械硬盘组磁盘阵列，搞成NAS存储服务器做个私有云。另外结合esxi或者是docker能跑很多好玩的东西，这里就不一一列举了，感兴趣的小伙伴可以搜索一下自建NAS服务器 ALL IN ONE。</li>
<li>tk域名是白嫖的，在DNS服务商那里却不被支持（这就是白嫖的代价吧）。自己又穷，买不起域名哈哈哈，就搞了个垃圾域名做中转，4块钱人民币一年哈哈哈。</li>
</ul>
<h2 id="网络拓扑图"><a href="#网络拓扑图" class="headerlink" title="网络拓扑图"></a>网络拓扑图</h2><p>下面这个是结合自己家庭网络拓扑图和已有的一些服务的网络拓扑图，用这个实现二级域名访问+SSL。</p>
<p><img src="https://hoey-images.oss-cn-hangzhou.aliyuncs.com/img/image-20230504212114306.png" alt="image-20230504212114306"></p>
<p>从最右边开始一层一层解释所做的事情：</p>
<ol>
<li><p>首先联系联通宽带，给到公网IP，将自己内网服务，在软路由内部通过端口映射的方式开放到外网。如果没有公网IP，也可以用frp等工具实现内网穿透。</p>
</li>
<li><p>接下来要解决公网IP变动的问题（联通给的公网IP是动态的，每隔一段时间就会变）。DNS服务商我选择的是Cloudflare，实现DDNS这块是参考开源项目，改写了一个脚本，其主要功能是：以轮训的方式，动态监测公网IP变更，将A记录通过API的方式更新到Cloudflare以实现DNS解析，具体脚本参考<a href="https://github.com/hoey94/cloudflare-api-ddns">cloudflare-api-dns</a>，当然网上也有很多类似以封装好的工具实现DDNS，比如<a href="https://github.com/jeessy2/ddns-go">ddns-go</a></p>
</li>
<li><p>在自己的VPS上搭建好<a href="https://github.com/NginxProxyManager/nginx-proxy-manager">Nginx Project Manager</a>（后面我们简称NPM），用来整合自己所有的服务，并添加SSL认证。</p>
</li>
<li><p>在Cloudflare创建记录将tk域名映射到VPS上，反向代理接受到请求，转发到4块钱买的域名(hoey.asia)上，哈哈哈。</p>
</li>
</ol>
<h2 id="在CentOS-7上-安装-NPM"><a href="#在CentOS-7上-安装-NPM" class="headerlink" title="在CentOS 7上 安装 NPM"></a>在CentOS 7上 安装 NPM</h2><ol>
<li>确保安装了docker 和docker-compose</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker</span></span><br><span class="line">yum remove -y docker   docker-client   docker-client-latest   docker-common   docker-latest   docker-latest-logrotate   docker-logrotate   docker-selinux   docker-engine-selinux   docker-engine</span><br><span class="line">yum install -y yum-utils   device-mapper-persistent-data   lvm2</span><br><span class="line">sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line">sudo yum makecache fast</span><br><span class="line">yum install -y docker-ce</span><br><span class="line">systemctl start docker.service</span><br><span class="line">systemctl enable docker.service</span><br><span class="line">docker -v</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker-compose</span></span><br><span class="line">curl -L https://github.com/docker/compose/releases/download/v2.3.3/docker-compose-linux-x86_64 -o /usr/local/bin/docker-compose</span><br><span class="line">chmod +x /usr/local/bin/docker-compose</span><br><span class="line">docker-compose --version</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">开启ipv6防止日志文件过大 (可选)</span></span><br><span class="line">cat &gt; /etc/docker/daemon.json &lt;&lt;EOF</span><br><span class="line">&#123;</span><br><span class="line">    &quot;log-driver&quot;: &quot;json-file&quot;,</span><br><span class="line">    &quot;log-opts&quot;: &#123;</span><br><span class="line">        &quot;max-size&quot;: &quot;20m&quot;,</span><br><span class="line">        &quot;max-file&quot;: &quot;3&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;ipv6&quot;: true,</span><br><span class="line">    &quot;fixed-cidr-v6&quot;: &quot;fd00:dead:beef:c0::/80&quot;,</span><br><span class="line">    &quot;experimental&quot;:true,</span><br><span class="line">    &quot;ip6tables&quot;:true</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>使用docker-compose 安装npm</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir -p /data/docker_data/npm</span><br><span class="line">cd /data/docker_data/npm</span><br><span class="line">vim docker-compose.yml</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将内容粘贴进去 start</span></span><br><span class="line">version: &#x27;3&#x27;</span><br><span class="line">services:</span><br><span class="line">  app:</span><br><span class="line">    image: &#x27;jc21/nginx-proxy-manager:latest&#x27;</span><br><span class="line">    restart: unless-stopped</span><br><span class="line">    ports:</span><br><span class="line">      - &#x27;80:80&#x27;  # 冒号左边可以改成自己服务器未被占用的端口</span><br><span class="line">      - &#x27;81:81&#x27;  # 冒号左边可以改成自己服务器未被占用的端口</span><br><span class="line">      - &#x27;443:443&#x27; # 冒号左边可以改成自己服务器未被占用的端口</span><br><span class="line">    volumes:</span><br><span class="line">      - ./data:/data # 冒号左边可以改路径，现在是表示把数据存放在在当前文件夹下的 data 文件夹中</span><br><span class="line">      - ./letsencrypt:/etc/letsencrypt  # 冒号左边可以改路径，现在是表示把数据存放在在当前文件夹下的 letsencrypt 文件夹中</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将内容粘贴进去 end</span> </span><br><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>更新NPM</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /root/data/docker_data/npm</span><br><span class="line"></span><br><span class="line">docker-compose down </span><br><span class="line"></span><br><span class="line">cp -r /data/docker_data/npm /data/docker_data/npm.archive  # 万事先备份，以防万一</span><br><span class="line"></span><br><span class="line">docker-compose pull</span><br><span class="line"></span><br><span class="line">docker-compose up -d    # 请不要使用 docker-compose stop 来停止容器，因为这么做需要额外的时间等待容器停止；docker-compose up -d 直接升级容器时会自动停止并立刻重建新的容器，完全没有必要浪费那些时间。</span><br><span class="line"></span><br><span class="line">docker image prune  # prune 命令用来删除不再使用的 docker 对象。删除所有未被 tag 标记和未被容器使用的镜像</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>卸载NPM</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /root/data/docker_data/npm</span><br><span class="line"></span><br><span class="line">docker-compose down </span><br><span class="line"></span><br><span class="line">rm -rf /root/data/docker_data/npm  # 完全删除映射到本地的数据</span><br></pre></td></tr></table></figure>



<h2 id="结合Cloudflare-配置NPM"><a href="#结合Cloudflare-配置NPM" class="headerlink" title="结合Cloudflare 配置NPM"></a>结合Cloudflare 配置NPM</h2><p>NPM默认账号密码: <a href="mailto:&#x61;&#x64;&#x6d;&#105;&#x6e;&#x40;&#101;&#120;&#97;&#109;&#112;&#x6c;&#x65;&#46;&#x63;&#111;&#109;">&#x61;&#x64;&#x6d;&#105;&#x6e;&#x40;&#101;&#120;&#97;&#109;&#112;&#x6c;&#x65;&#46;&#x63;&#111;&#109;</a>/changeme，登录后修改</p>
<p>登录Cloudflare，到自己的域名中添加A记录，指向VPS服务器（我的VPS是110.123.11.1，域名是hoey.tk）</p>
<p><img src="https://hoey-images.oss-cn-hangzhou.aliyuncs.com/img/image-20230504222932398.png" alt="image-20230504222932398"></p>
<p>在NPM中添加对应的反向代理配置，并打开SSL，（下图是以nas这条记录为例，描述NPM的配置）</p>
<p><img src="https://hoey-images.oss-cn-hangzhou.aliyuncs.com/img/image-20230504214014283.png" alt="image-20230504214014283"></p>
<p>之后开启SSL认证</p>
<p><img src="https://hoey-images.oss-cn-hangzhou.aliyuncs.com/img/image-20230504214052552.png" alt="image-20230504214052552"></p>
<p>点击保存即可。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>配置完成以后，就可以使用nas.hoey.tk访问nas服务了，当用户访问nas.hoey.tk时，在网络中它的链路应该如下图所示：</p>
<p><img src="https://hoey-images.oss-cn-hangzhou.aliyuncs.com/img/image-20230504214857962.png" alt="image-20230504214857962"></p>
<p>以上</p>
]]></content>
  </entry>
  <entry>
    <title>基于Python的简易FS服务</title>
    <url>/posts/20221212164304-b422eee5.html</url>
    <content><![CDATA[<p>创建start.py，代码如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="comment"># Python 3</span></span><br><span class="line">    <span class="keyword">from</span> http.server <span class="keyword">import</span> HTTPServer, SimpleHTTPRequestHandler, test <span class="keyword">as</span> test_orig</span><br><span class="line">    <span class="keyword">import</span> sys</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test</span> (*args):</span><br><span class="line">        test_orig(*args, port=<span class="built_in">int</span>(sys.argv[<span class="number">1</span>]) <span class="keyword">if</span> <span class="built_in">len</span>(sys.argv) &gt; <span class="number">1</span> <span class="keyword">else</span> <span class="number">8000</span>)</span><br><span class="line"><span class="keyword">except</span> ImportError: <span class="comment"># Python 2</span></span><br><span class="line">    <span class="keyword">from</span> BaseHTTPServer <span class="keyword">import</span> HTTPServer, test</span><br><span class="line">    <span class="keyword">from</span> SimpleHTTPServer <span class="keyword">import</span> SimpleHTTPRequestHandler</span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CORSRequestHandler</span> (<span class="title class_ inherited__">SimpleHTTPRequestHandler</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">end_headers</span> (self):</span><br><span class="line">        self.send_header(<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>, <span class="string">&#x27;*&#x27;</span>)</span><br><span class="line">        SimpleHTTPRequestHandler.end_headers(self)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    test(CORSRequestHandler, HTTPServer)</span><br></pre></td></tr></table></figure>

<p>运行start.py,端口为8000</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python start.py 8000</span><br></pre></td></tr></table></figure>

]]></content>
  </entry>
  <entry>
    <title>家庭网络拓扑</title>
    <url>/posts/20230711112128-628a2fb5.html</url>
    <content><![CDATA[<p>前段时间618新入手了几块硬盘，买回来组一个NAS，下面是家里的网络拓扑逻辑图 </p>
<p><img src="https://hoey-images.oss-cn-hangzhou.aliyuncs.com/img/image-20230711130249774.png" alt="image-20230711130249774"></p>
<p>在其中完成了以下内容：</p>
<ol>
<li>网络统一管理，包括网络分割如划分子网；网络的优化如实现拦截、翻墙、过滤广告、加速；内外网穿透。</li>
<li>ESXI虚拟化，对物理机的CPU计算、存储和网络资源高效利用，EXSI高效的横向拓展能力和简易的操作都非常的优秀。</li>
<li>NAS（网络附加存储），数据共享与存储、备份与恢复、远程访问、横向磁盘扩容。</li>
<li>边缘计算，网络资源共享，提升网络三大运营商CDN网络加速。</li>
</ol>
<p>得到的好处：</p>
<ol>
<li>全端的无差异实时备份，包括Mac、Windows、IPad、IPhone等设备</li>
<li>现在市面上各大云盘，某度云、某里云等等，现在统统废弃，全部用NAS就可以解决，相当于买了个所有云盘的VIP</li>
<li>网络方面的国内外无差异化上网体验。</li>
<li>给老婆刷刷剧，看看电影都很方便。</li>
</ol>
<p><a href="http://192.168.1.1/cu.html">http://192.168.1.1/cu.html</a></p>
<p>CUAdmin32216618</p>
]]></content>
  </entry>
  <entry>
    <title>拉链表</title>
    <url>/posts/20230221094327-2e5ad32b.html</url>
    <content><![CDATA[<p>拉链表思路图：</p>
<p><img src="https://hoey-images.oss-cn-hangzhou.aliyuncs.com/img/image-20230221094438645.png" alt="image-20230221094438645"></p>
<p>使用HiveSQL增量完成拉链表加工思路：</p>
<p><img src="https://hoey-images.oss-cn-hangzhou.aliyuncs.com/img/image-20230221094348740.png" alt="image-20230221094348740"></p>
]]></content>
  </entry>
  <entry>
    <title>航司运行领域术语</title>
    <url>/posts/20231109104344-b6e0f1c6.html</url>
    <content><![CDATA[<p>FOC(FLIGHT OPERATION CONTROL)即航空公司主要的航班运行控制系统。</p>
<p>AFTN(Aeronautical Fixed Telecommunication Network)用于民航空管各类工作报文的网络和规范，通常传输有航班的动态信息报文，比如起飞落地报文、天气报文、情报报文、取消报文等等。</p>
<p>SITA 国际电讯协会,和AFTN一样也是民航一种电报规范，主要用于商务报文传输，比如货运、客运报文、离港订座报文等；</p>
<p>ACARS（Aircraft Addressing and Reporting System）地空通信的链路，是飞机在空中和地面进行数字化报文传输主要的方式；</p>
<p>MCC（Maintenance Control Center）工程维修处的一个处室，是AOC值班的重要岗位，是负责每日航班运行的飞机的故障维修保障岗位；</p>
<p>ADSB （Automatic Dependent Surveillance – Broadcast）通过飞机上的机载GPS等系统，获得飞机自身的位置信息，再通过飞机上的通信设备，将飞机自身的位置信息发送出来，地面人员可以利用通信设备，接收到飞机发送出来的这些信息，从而实现对飞机的监视</p>
<p>CDM （Collaborative Decision-Making 协同决策）是空管和航空公司以及机场协同运作的一个终端流量控制系统；俗称，飞机跑道排队系统；</p>
<p>ACDM（Airport Collaborative Decision-Making 机场协同决策）是机场和航空公司协同运作的一个机场协同指挥系统；</p>
<p>GANTT 条状图(Bar chart)。其通过条状图来显示项目，进度，和其他时间相关的系统进展的内在关系随着时间进展的情况；</p>
<p>HORAM （HO吉祥的二字码，RAM RISK ANALYSIS MANAGEMENT）吉祥的航班风险分析管理系统</p>
<p>CI执行率监控 Cost index成本指数，节油中会针对每条特定航线根据经验给出CI指导政策，系统会根据历史数据分析飞行员节油情况和CI对比</p>
<p>EFB （ELECTRIC FLIGHT BAG)电子飞行包，IPAD代替原来的纸箱，里面可以安装各种电子航图、手册、气象APP、性能计算APP等；</p>
<p>HCC （Hub Control Center）吉祥的地面保障系统，主要是场站，虹桥、浦东有关地面保障单位调度的系统；</p>
<p>SMS （Safety Management System）公司安全风险检查系统，涉及公司任何方面的隐患提报以及整改闭环管理</p>
<p>QAR (Quick Access Recorder)就是黑盒子数据，记录了每个飞行航班的飞机的全部抽样参数</p>
<p>SOP（Standard Operation Procedure）标准作业程序，吉祥航空公司的飞行员SOP手册就是飞机标准操作手册；</p>
]]></content>
  </entry>
</search>
